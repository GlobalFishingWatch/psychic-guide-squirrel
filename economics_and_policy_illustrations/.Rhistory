group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(distance_hours = sum(distancehours, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = (distance_hours), color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(distance_hours = sum(hours, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = (distance_hours), color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(distance_hours = sum(distance, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = (distance_hours), color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
summarize(hours = sum(hours, na.rm = T),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= year, y = hours, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(distance = sum(distance, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = (distance), color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(distance = sum(distance, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = distance, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(hours = sum(hours, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = hours, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(distance_traveled = sum(distance, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = distance_traveled, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(distance_hours = sum(distancehours, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = distance_hours, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
summarize(hours = sum(distance, na.rm = T),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= year, y = hours, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
summarize(hours = sum(hours, na.rm = T),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= year, y = hours, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
consistently_active_vessels %>%
group_by(country_name, year) %>%
summarise(hours = sum(hours),
distance = sum(distance),
distancehours = sum(distancehours))
library(docxtractr)
t <- lapply(c(1:6), function(x) read_docx(paste("/Users/JuanMayorga/Box Sync/high_seas_profits/literature/supp_materials_sumalia_2012/Table_S",x,".docx", sep = "")))
t <- lapply(c(1:6), function(x) docx_extract_all_tbls(t[[x]], guess_header = TRUE)[[1]])
t <- lapply(t, setNames, nm = c("Country", "Landings", "Landed Value", "Variable Cost", "Subsidies"))
t <- lapply(c(1:6), function(x) t[[x]][-c(1,2), ] )
subsidies_by_country <- do.call("rbind", t) %>%
mutate_at(vars(-Country), funs(as.numeric(gsub(",", "", .)))) %>%
filter(Country != "Total") %>%
arrange(Country) %>%
mutate(Relative_subsidies = `Subsidies`/abs(`Landed Value`-`Variable Cost`)) %>%
rename(country_name = Country) %>%
mutate(country_name = replace(country_name, country_name == "USA", "United States"),
country_name = replace(country_name, country_name == "China Main", "China"),
country_name = replace(country_name, country_name == "UK", "United Kingdom"),
country_name = replace(country_name, country_name == "Russian Fed", "Russia"),
country_name = replace(country_name, country_name == "Korea Rep", "South Korea"))
subsidies_by_country %>%
filter(Relative_subsidies <= 1.5) %>%
top_n(30, `Landed Value`) %>%
ggplot()+
geom_bar(aes(x = forcats::fct_reorder(country_name, Relative_subsidies), y = Relative_subsidies), stat = 'identity')+
coord_flip()
consistently_active_vessels <- consistently_active_vessels %>%
left_join(subsidies_by_country %>%
select(country_name, total_subsidies = Subsidies, relative_subsidies = Relative_subsidies))
subsidies_by_country %>%
anti_join(consistently_active_vessels) %>%
arrange(desc(Landings))
fits <- consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies)) %>%
group_by(country_name) %>%
do(fit = lm(hours ~ fuel_price , data = .))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name)))
fits <- consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies)) %>%
group_by(country_name) %>%
do(fit = lm(distance ~ fuel_price , data = .))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name)))
fits <- consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies)) %>%
group_by(country_name) %>%
do(fit = lm(distancehours ~ fuel_price , data = .))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name)))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(relative_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name)))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name)))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name))) %>%
geom_point(aes(x = subsidies, y = slope, key = country_name), data = . %>% filter(country_name == "Argentina"))
consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name))+
geom_point(aes(x = subsidies, y = slope, key = country_name), data = . %>% filter(country_name == "Argentina"))
consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name))+
geom_point(aes(x = subsidies, y = slope, key = country_name),color = 'red', data = . %>% filter(country_name == "Argentina"))
fits <- consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies)) %>%
group_by(country_name) %>%
do(fit = lm(hours ~ fuel_price , data = .))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name))+
geom_point(aes(x = subsidies, y = slope, key = country_name),color = 'red', data = . %>% filter(country_name == "Argentina")))
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(distance_traveled = sum(distance, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = distance_traveled, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(hours = sum(hours, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = hours, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(distance_hours = sum(distancehours, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = distance_hours, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
fits <- consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies)) %>%
group_by(country_name) %>%
do(fit = lm(distance ~ fuel_price , data = .))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name))+
geom_point(aes(x = subsidies, y = slope, key = country_name),color = 'red', data = . %>% filter(country_name == "Argentina")))
fits <- consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies)) %>%
group_by(country_name) %>%
do(fit = lm(hours ~ fuel_price , data = .))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name))+
geom_point(aes(x = subsidies, y = slope, key = country_name),color = 'red', data = . %>% filter(country_name == "Argentina")))
library(tidyverse)
library(bigrquery)
library(DBI)
library(rvest)
library(broom)
BQ_connection <-  dbConnect(dbi_driver(), dataset = "", project = "ucsb-gfw")
consistently_active_vessels <- active_2016 %>%
inner_join(active_2014_2015, by = "mmsi") %>%
inner_join(active_2012_2013, by = "mmsi") %>%
as_data_frame()
consistently_active_vessels <- consistently_active_vessels %>%
gather(key, value, -mmsi) %>%
separate(key,c("measure", "year"), sep="_") %>%
spread(measure, value)
consistently_active_vessels <- consistently_active_vessels %>%
mutate(code = ifelse(nchar(mmsi) == 9,as.numeric(substr(mmsi,1,3)),0)) %>%
left_join(country_codes %>% select(code, country_name), by = "code") %>%
select(-code)
n_distinct(consistently_active_vessels$mmsi)
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
summarize(hours = sum(hours, na.rm = T),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= year, y = hours, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
fuel_prices <- data_frame(year = c("2012","2013","2014","2015"),
fuel_price = c(973,934,875,547))
consistently_active_vessels <- consistently_active_vessels %>%
left_join(fuel_prices)
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(hours = sum(hours, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = hours, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(distance_traveled = sum(distance, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = distance_traveled, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
plotly::ggplotly(
consistently_active_vessels %>%
filter(year != 2016 & year != 2012) %>%
group_by(year, country_name) %>%
#filter(country_name %in% c("China", "Spain", "Taiwan", "Japan", "France", "United States", "South Korea", "Norway","Iceland", "Argentina")) %>%
summarize(distance_hours = sum(distancehours, na.rm = TRUE),
fuel_price = mean(fuel_price),
vessels = n_distinct(mmsi)) %>%
ggplot()+
geom_line(aes(x= fuel_price, y = distance_hours, color = country_name, group = country_name, key = country_name))+
guides(color = FALSE, group = FALSE)+
theme_minimal())
library(docxtractr)
t <- lapply(c(1:6), function(x) read_docx(paste("/Users/JuanMayorga/Box Sync/high_seas_profits/literature/supp_materials_sumalia_2012/Table_S",x,".docx", sep = "")))
t <- lapply(c(1:6), function(x) docx_extract_all_tbls(t[[x]], guess_header = TRUE)[[1]])
t <- lapply(t, setNames, nm = c("Country", "Landings", "Landed Value", "Variable Cost", "Subsidies"))
t <- lapply(c(1:6), function(x) t[[x]][-c(1,2), ] )
subsidies_by_country <- do.call("rbind", t) %>%
mutate_at(vars(-Country), funs(as.numeric(gsub(",", "", .)))) %>%
filter(Country != "Total") %>%
arrange(Country) %>%
mutate(Relative_subsidies = `Subsidies`/abs(`Landed Value`-`Variable Cost`)) %>%
rename(country_name = Country) %>%
mutate(country_name = replace(country_name, country_name == "USA", "United States"),
country_name = replace(country_name, country_name == "China Main", "China"),
country_name = replace(country_name, country_name == "UK", "United Kingdom"),
country_name = replace(country_name, country_name == "Russian Fed", "Russia"),
country_name = replace(country_name, country_name == "Korea Rep", "South Korea"))
subsidies_by_country %>%
filter(Relative_subsidies <= 1.5) %>%
top_n(30, `Landed Value`) %>%
ggplot()+
geom_bar(aes(x = forcats::fct_reorder(country_name, Relative_subsidies), y = Relative_subsidies), stat = 'identity')+
coord_flip()
consistently_active_vessels <- consistently_active_vessels %>%
left_join(subsidies_by_country %>%
select(country_name, total_subsidies = Subsidies, relative_subsidies = Relative_subsidies))
subsidies_by_country %>%
anti_join(consistently_active_vessels) %>%
arrange(desc(Landings))
fits <- consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies)) %>%
group_by(country_name) %>%
do(fit = lm(hours ~ fuel_price , data = .))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name))+
geom_point(aes(x = subsidies, y = slope, key = country_name),color = 'red', data = . %>% filter(country_name == "Argentina")))
fits <- consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies)) %>%
group_by(country_name) %>%
do(fit = lm(hours ~ fuel_price , data = .))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name)))
fits <- consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies)) %>%
group_by(country_name) %>%
do(fit = lm(hours ~ distance , data = .))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name))+
geom_point(aes(x = subsidies, y = slope, key = country_name),color = 'red', data = . %>% filter(country_name == "Argentina")))
fits <- consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies)) %>%
group_by(country_name) %>%
do(fit = lm(distance ~ fuel_price , data = .))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name))+
geom_point(aes(x = subsidies, y = slope, key = country_name),color = 'red', data = . %>% filter(country_name == "Argentina")))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name)))
fits <- consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies)) %>%
group_by(country_name) %>%
do(fit = lm(distancehours ~ fuel_price , data = .))
plotly::ggplotly(consistently_active_vessels %>%
filter(year!= 2012 & year != 2016 & !is.na(country_name) & !is.na(relative_subsidies) & country_name != "Nicaragua") %>%
group_by(country_name) %>%
summarise(subsidies = mean(total_subsidies)) %>%
left_join(fits %>%
tidy(fit) %>%
filter(term == "fuel_price") %>%
select(country_name, slope = estimate)) %>%
ggplot()+
geom_point(aes(x = subsidies, y = slope, key = country_name)))
