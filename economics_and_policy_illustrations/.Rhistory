variables
values
values[[2]]
values[[2-1]]
values[[2-1]] %in% variable
values[[2-1]] %in% variables
values <- url %>%
read_html() %>%
html_nodes("#DetailsTable td") %>%
html_text()
values
values <- url %>%
read_html() %>%
html_nodes("#DetailsTable td")
nodes(values)
print(values)
html_attrs(values)
html_node(values)
html_node(values, '#CharacterField')
url %>%
read_html() %>%
html_tree()
??htmlTreeParse
url %>%
read_html() %>%
html_children()
values <- url %>%
read_html() %>%
html_nodes("#DetailsTable td")
values <- url %>%
read_html() %>%
html_nodes("#DetailsTable td") %>%
html_text()
variables <- values[grepl(":", values)]
variables
values <- url %>%
read_html() %>%
html_nodes("#DetailsTable td")
values
values
values <- url %>%
read_html() %>%
html_nodes("#DetailsTable td")
values[1]
values[[1]]
values[[1]]
values[[1]]$node
values[1]$node
values[[1]]$node
values[[1]]$doc
values <- url %>%
read_html() %>%
html_nodes("#DetailsTable td") %>%
html_text()
variables <- values[grepl(":", values)]
values[[2-1]] %in% variables
variables
variables <- values[grepl("lenght", values)]
values[[2-1]] %in% variables
variables <- values[grepl("lengtt", values)]
variables <- values[grepl("length", values)]
variables
variables <- values[grepl("ength", values)]
variables
variables <- values[grepl(":", values)]
variables
values[[2-1]] %in% variables
values[values[[2-1]] %in% variables]
values[[]][values[[2-1]] %in% variables]
variables <- values[grepl(":", values)]
variables
table <- url %>%
read_html() %>%
html_nodes("#DetailsTable td") %>%
html_text()
variables <- table[grepl(":", table)]
variables
variables <- table[grepl(":", table)] %>%
as_data_frame()
variables
colnames(variables) <- "variable"
variables
variables$variable[1]
v <- variables$variable[1]
table[grepl(":", table)]
table
table %in% v
table[table %in% v + 1]
table[table %in% v]
table[1 +  table %in% v]
table[grepl(":", table)]
table %in% v
sum(table %in% v)
cumsum(table %in% v)
x <- table %in% v
cumsum(x) + !x[1]
v <- variables$variable[5]
variables
v
table[grepl(":", table)]
x <- table %in% v
x
cumsum(x) + !x[1]
cumsum(x) + !x[0]
cumsum(x) + !x[1]
cumsum(x)
as.numeric(x)
table[1 + r]
r <- as.numeric(x)
table[1 + r]
table
table[grepl(":", table)]
table[grepl(":", table)]
table[grepl(":", table)]
variables
table[grepl(":", table)]
table %in% v
table[table %in% v]
(table %in% v)==TRUE
x <- (table %in% v)
x == T
match(T,(table %in% v))
(table %in% v)
as.numeric(table[1 + x])
r <- as.numeric(table[(1 + x)])
as.numeric(table[(1 + x)])
table[1]
x
x <- match(T,(table %in% v))
x
as.numeric(table[(1 + x)])
x <- match(T,(table %in% v))
x
as.numeric(table[(1 + match(T,(table %in% v)) )])
x <- match(T,(table %in% v))
x
as.numeric(table[(1 + 9)])
table
table[10]
d = x +1
as.numeric(table[d])
x <- match(T,(table %in% v))
x
r <- as.numeric(table[x+1])
x
type(x)
class(x)
x + 1
d <- x+1
d
r <- as.numeric(table[d])
r <- table[d]
table[d]
which(table %in% v)
which(table %in% v) + 1
table[which(table %in% v) + 1]
variables <- table[grepl(c("ength"), table)] %>%
as_data_frame()
colnames(variables) <- "variable"
variables
table
variables <- table[grepl(c("ength", "tonnage"), table)] %>%
as_data_frame()
colnames(variables) <- "variable"
variables
variables <- table[grepl(c("ength", "Gross"), table)] %>%
as_data_frame()
colnames(variables) <- "variable"
variables
variables <- table[grepl(c("Gross"), table)] %>%
as_data_frame()
colnames(variables) <- "variable"
variables
table
grepl(paste(v_if_interest, collapse = "|"), table)
v_if_interest <-  c("Length", "tonnage", "power")
grepl(paste(v_if_interest, collapse = "|"), table)
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)] %>%
as_data_frame()
variables
colnames(variables) <- "variable"
v_if_interest <-  c("Length", "tonnage", "power")
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)] %>%
as_data_frame()
table[which(table %in% v_if_interest) + 1]
which(table %in% v_if_interest)
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)] %>%
as_data_frame()
colnames(variables) <- "variable"
table[which(table %in% variables$variable) + 1]
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)]
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)]
table[which(table %in% variables) + 1]
variables
table[which(table %in% variables) + 1]
table[which(table %in% variables) + 1] %>%
setNames(v_if_interest)
map(variables, table[which(table %in% variables) + 1] %>%
setNames(v_if_interest))
map(variables, ~ table[which(table %in% .x) + 1])
map(variables, ~ table[which(table %in% .x) + 1]) %>%
setNames(v_if_interest)
map_int(variables, ~ table[which(table %in% .x) + 1]) %>%
setNames(v_if_interest)
map_chr(variables, ~ table[which(table %in% .x) + 1]) %>%
setNames(v_if_interest)
map_chr(variables, ~ table[which(table %in% .x) + 1]) %>%
setNames(v_if_interest)
all_urls <- map_chr(vids$rfmo_id, ~ paste("https://www.iattc.org/VesselRegister/VesselDetails.aspx?VesNo=",.x ,sep = ""))
table <- all_urls %>%
read_html() %>%
html_nodes("#DetailsTable td") %>%
html_text()
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)]
variables
get_data_from_IATTC <- function(rfmo_id){
url <- paste("https://www.iattc.org/VesselRegister/VesselDetails.aspx?VesNo=", rfmo_id ,sep = "")
table <- url %>%
read_html() %>%
html_nodes("#DetailsTable td") %>%
html_text()
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)]
map_chr(variables, ~ table[which(table %in% .x) + 1]) %>%
setNames(variables_of_interest)
}
please_work <- map(vids$rfmo_id[1:5], get_data_from_IATTC)
variables_of_interest <-  c("Length", "tonnage", "power")
get_data_from_IATTC <- function(rfmo_id){
url <- paste("https://www.iattc.org/VesselRegister/VesselDetails.aspx?VesNo=", rfmo_id ,sep = "")
table <- url %>%
read_html() %>%
html_nodes("#DetailsTable td") %>%
html_text()
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)]
map_chr(variables, ~ table[which(table %in% .x) + 1]) %>%
setNames(variables_of_interest)
}
please_work <- map(vids$rfmo_id[1:5], get_data_from_IATTC)
please_work <- map_df(vids$rfmo_id[1:5], get_data_from_IATTC)
get_data_from_IATTC <- function(rfmo_id){
url <- paste("https://www.iattc.org/VesselRegister/VesselDetails.aspx?VesNo=", rfmo_id ,sep = "")
table <- url %>%
read_html() %>%
html_nodes("#DetailsTable td") %>%
html_text()
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)]
map_chr(variables, ~ table[which(table %in% .x) + 1])
}
please_work <- map_df(vids$rfmo_id[1:5], get_data_from_IATTC)
get_data_from_IATTC <- function(rfmo_id){
url <- paste("https://www.iattc.org/VesselRegister/VesselDetails.aspx?VesNo=", rfmo_id ,sep = "")
table <- url %>%
read_html() %>%
html_nodes("#DetailsTable td") %>%
html_text()
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)]
map_chr(variables, ~ table[which(table %in% .x) + 1]) %>%
setNames(variables_of_interest)
}
please_work <- map(vids$rfmo_id[1:5], get_data_from_IATTC)
please_work[[1]]
please_work <- map(vids$rfmo_id[1:5], get_data_from_IATTC) %>%
set_names(vids$rfmo_id[1:5])
unlist(please_work)
get_data_from_IATTC <- function(rfmo_id){
url <- paste("https://www.iattc.org/VesselRegister/VesselDetails.aspx?VesNo=", rfmo_id ,sep = "")
table <- url %>%
read_html() %>%
html_nodes("#DetailsTable td") %>%
html_text()
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)]
map_chr(variables, ~ table[which(table %in% .x) + 1])
}
please_work <- map(vids$rfmo_id[1:5], get_data_from_IATTC) %>%
set_names(vids$rfmo_id[1:5])
please_work <- map_df(vids$rfmo_id[1:5], get_data_from_IATTC) %>%
set_names(vids$rfmo_id[1:5])
please_work <- map_df(vids$rfmo_id[1:5], get_data_from_IATTC)
get_data_from_IATTC <- function(rfmo_id){
url <- paste("https://www.iattc.org/VesselRegister/VesselDetails.aspx?VesNo=", rfmo_id ,sep = "")
table <- url %>%
read_html() %>%
html_nodes("#DetailsTable td") %>%
html_text()
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)]
map(variables, ~ table[which(table %in% .x) + 1])
}
please_work <- map_df(vids$rfmo_id[1:5], get_data_from_IATTC)
get_data_from_IATTC <- function(rfmo_id){
url <- paste("https://www.iattc.org/VesselRegister/VesselDetails.aspx?VesNo=", rfmo_id ,sep = "")
table <- url %>%
read_html() %>%
html_nodes("#DetailsTable td") %>%
html_text()
variables <- table[grepl(paste(v_if_interest, collapse = "|"), table)]
map_chr(variables, ~ table[which(table %in% .x) + 1]) %>%
setNames(variables_of_interest)
}
please_work <- map(vids$rfmo_id[1:5], get_data_from_IATTC) %>%
set_names(vids$rfmo_id[1:5])
data.table::rbindlist(please_work, fill=TRUE)
please_work <- map(vids$rfmo_id[1:5], get_data_from_IATTC) %>%
set_names(vids$rfmo_id[1:5])
data.table::rbindlist(please_work)
please_work <- map(vids$rfmo_id[1:5], get_data_from_IATTC) %>%
set_names(vids$rfmo_id[1:5])
as.data.frame(please_work)
do.call(rbind, Map(as.data.frame,please_work)
do.call(rbind, Map(as.data.frame,please_work))
do.call(rbind, please_work)
t <- do.call(rbind, please_work)
t <- do.call(rbind, please_work) %>%
as_data_frame()
View(t)
t <- do.call(rbind, please_work) %>%
as.data.frame()
View(t)
t <- do.call(rbind, please_work) %>%
tibble::rownames_to_column()
t <- do.call(rbind, please_work) %>%
as.data.frame() %>%
tibble::rownames_to_column()
View(t)
t <- do.call(rbind, please_work) %>%
as.data.frame() %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname)
t <- do.call(rbind, please_work) %>%
as.data.frame(stringAsfactors = F) %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname)
t <- do.call(rbind, please_work) %>%
as.data.frame() %>%
mutate_all(funs(as.numeric())) %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname)
do.call(rbind, please_work) %>%
as.data.frame() %>%
mutate_all(funs(as.numeric()))
do.call(rbind, please_work) %>%
as.data.frame() %>%
mutate_all(funs(as.numeric(.)))
t <- do.call(rbind, please_work) %>%
data.frame() %>%
mutate_all(funs(as.numeric(.))) %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname)
t <- do.call(rbind, please_work) %>%
data.frame(stringsAsFactors = F) %>%
mutate_all(funs(as.numeric(.))) %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname)
t <- do.call(rbind, please_work) %>%
data.frame(stringsAsFactors = F) %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname) %>%
mutate_at(vars(-rfmo_id),funs(as.numeric(.)))
please_work <- map(vids$rfmo_id[1:50], get_data_from_IATTC) %>%
set_names(vids$rfmo_id[1:50])
t <- do.call(rbind, please_work) %>%
data.frame(stringsAsFactors = F) %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname) %>%
mutate_at(vars(-rfmo_id),funs(as.numeric(.)))
View(t)
please_work <- map(vids$rfmo_id, get_data_from_IATTC) %>%
set_names(vids$rfmo_id)
t <- do.call(rbind, please_work) %>%
data.frame(stringsAsFactors = F) %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname) %>%
mutate_at(vars(-rfmo_id),funs(as.numeric(.)))
View(t)
View(vids)
please_work <- map(vids$rfmo_id, get_data_from_IATTC) %>%
set_names(vids$rfmo_id)
rfmos_ids <- vids$rfmo_id
please_work <- map(rfmos_ids, get_data_from_IATTC) %>%
set_names(rfmos_ids)
please_work <- map(rfmos_ids, get_data_from_IATTC)
please_work <- map(rfmos_ids, safely(get_data_from_IATTC)) %>%
set_names(rfmos_ids)
please_work %>% transpose()
please_work <- please_work %>% transpose()
ok <- map_lgl(please_work$error, is.null)
rfmos_ids[ok]
length(rfmos_ids[ok])
length(rfmos_ids[!ok])
rfmos_ids[!ok]
t <- do.call(rbind, please_work) %>%
data.frame(stringsAsFactors = F) %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname) %>%
mutate_at(vars(-rfmo_id),funs(as.numeric(.)))
t <- do.call(rbind, please_work$result) %>%
data.frame(stringsAsFactors = F) %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname) %>%
mutate_at(vars(-rfmo_id),funs(as.numeric(.)))
do.call(rbind, please_work$result) %>%
data.frame(stringsAsFactors = F) %>%
tibble::rownames_to_column()
do.call(rbind, please_work$result) %>%
data.frame(stringsAsFactors = F)
rfmos_ids[!ok]
rfmos_ids <- vids$rfmo_id %>%
filter(!rfmo_id %in% c("9499","15617","8775","12423","11911","5451" ))
rfmos_ids <- vids$rfmo_id %>%
filter(!rfmo_id %in% c("9499","15617","8775","12423","11911","5451" ))
rfmos_ids <- vids %>%
filter(!rfmo_id %in% c("9499","15617","8775","12423","11911","5451" ))
rfmos_ids
rfmos_ids <- rfmos_ids$
please_work <- map(rfmos_ids, safely(get_data_from_IATTC)) %>%
set_names(rfmos_ids) %>%
transpose()
rfmos_ids <- rfmos_ids$rfmo_ids
rfmos_ids <- vids %>%
filter(!rfmo_id %in% c("9499","15617","8775","12423","11911","5451" ))
rfmos_ids <- rfmos_ids$rfmo_ids
rfmos_ids
please_work <- map(rfmos_ids, get_data_from_IATTC) %>%
set_names(rfmos_ids)
rfmos_ids <- rfmos_ids$rfmo_ids
please_work <- map(rfmos_ids, get_data_from_IATTC) %>%
set_names(rfmos_ids)
rfmos_ids
rfmos_ids <- vids %>%
filter(!rfmo_id %in% c("9499","15617","8775","12423","11911","5451" ))
rfmos_ids <- rfmos_ids$rfmo_ids
rfmos_ids
rfmos_ids <- vids %>%
filter(!rfmo_ids %in% c("9499","15617","8775","12423","11911","5451" ))
vids
rfmos_ids <- vids %>%
filter(!rfmo_id %in% c("9499","15617","8775","12423","11911","5451"))
rfmos_ids
rfmos_ids <- rfmos_ids$rfmo_id
please_work <- map(rfmos_ids, get_data_from_IATTC) %>%
set_names(rfmos_ids)
t <- do.call(rbind, please_work) %>%
data.frame(stringsAsFactors = F) %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname) %>%
mutate_at(vars(-rfmo_id),funs(as.numeric(.)))
View(t)
View(vids)
View(t)
do.call(rbind, please_work) %>%
data.frame(stringsAsFactors = F)
do.call(rbind, please_work) %>%
data.frame(stringsAsFactors = F) %>%
tibble::rownames_to_column()
t <- do.call(rbind, please_work) %>%
data.frame(stringsAsFactors = F)
View(t)
t <- do.call(rbind, please_work) %>%
data.frame(stringsAsFactors = F)
View(t)
t <- do.call(rbind, please_work)
View(t)
t <- do.call(rbind, please_work)
View(t)
View(t)
t <- do.call(rbind, please_work)
View(t)
class(t)
names(t)
t <- do.call(rbind, please_work)
names(t)
View(t)
names(please_work)
data.frame(id=names(please_work), nobs=unlist(please_work))
t <- data.frame(id=names(please_work), nobs=unlist(please_work))
View(t)
t <- do.call(rbind, please_work) %>%
data.frame(id = names(please_work),stringsAsFactors = F)
View(t)
t <- do.call(rbind, please_work) %>%
data_frame(id = names(please_work),stringsAsFactors = F)
t <- do.call(rbind, please_work) %>%
as.data.frame(id = names(please_work), stringsAsFactors = F)
View(t)
t <- do.call(rbind, please_work) %>%
as.data.frame(id = names(please_work), stringsAsFactors = F) %>%
tibble::rownames_to_column()
View(t)
t <- do.call(rbind, please_work) %>%
as.data.frame(id = names(please_work), stringsAsFactors = F) %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname) %>%
mutate_at(vars(-rfmo_id),funs(as.numeric(.)))
View(t)
matched_rfmo_ids <- do.call(rbind, please_work) %>%
as.data.frame(id = names(please_work), stringsAsFactors = F) %>%
tibble::rownames_to_column() %>%
rename(rfmo_id = rowname) %>%
mutate_at(vars(-rfmo_id),funs(as.numeric(.)))
matched_rfmo_ids
matched_mmsi <- matched_rfmo_ids %>%
left_join(vids)
matched_mmsi
matched_mmsi <- matched_rfmo_ids %>%
left_join(vids) %>%
select(mmsi, clav_TUVI,rfmo_id, length = Length, tonnage, power)
write_csv(matched_mmsi, "saved_files/matched_mmsi_IATTC.csv")
matched_mmsi %>%
ggplot()+
geom_point(aes(x = length, y = power))
matched_mmsi %>%
ggplot()+
geom_point(aes(x = length, y = tonnage))
